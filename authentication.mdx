---
title: "Autenticação"
description: "Como autenticar suas requisições na API Safefy"
---

A Safefy utiliza **OAuth2 Client Credentials** para autenticação. Você precisa obter um token JWT antes de fazer qualquer outra requisição.

## Como funciona

```mermaid
sequenceDiagram
    participant App as Sua Aplicação
    participant Safefy as API Safefy
    
    App->>Safefy: POST /v1/auth/token (credenciais)
    Safefy-->>App: Token JWT (expira em 1h)
    App->>Safefy: GET /v1/transactions (Authorization: Bearer token)
    Safefy-->>App: Dados da transação
```

## Obtendo o token

```bash
curl -X POST https://api-payment.safefypay.com.br/v1/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "grantType": "client_credentials",
    "publicKey": "pk_sandbox_abc123...",
    "secretKey": "sk_sandbox_xyz789..."
  }'
```

**Resposta:**

```json
{
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 3600,
    "environment": "Sandbox"
  }
}
```

## Usando o token

Inclua o token no header `Authorization` de todas as requisições:

```bash
curl https://api-payment.safefypay.com.br/v1/transactions \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

<Warning>
O token expira em **1 hora** (3600 segundos). Renove-o antes da expiração para evitar interrupções.
</Warning>

---

## Boas práticas de segurança

<CardGroup cols={2}>
  <Card title="Nunca exponha a secretKey" icon="shield">
    Mantenha a secretKey apenas no backend. Nunca a inclua em código frontend ou repositórios públicos.
  </Card>
  <Card title="Use variáveis de ambiente" icon="lock">
    Armazene suas credenciais em variáveis de ambiente ou serviços de secrets (AWS Secrets Manager, Vault, etc).
  </Card>
  <Card title="Renove antes de expirar" icon="rotate">
    Implemente logica para renovar o token antes dos 3600 segundos expirarem.
  </Card>
  <Card title="Configure IPs permitidos" icon="network-wired">
    No painel Safefy, restrinja o uso das credenciais apenas aos IPs do seu servidor.
  </Card>
</CardGroup>

---

## Erros comuns

| Codigo | Erro | Solução |
|--------|------|---------|
| 401 | Credenciais inválidas | Verifique publicKey e secretKey |
| 403 | IP não autorizado | Adicione o IP nas configurações da credencial |
| 429 | Rate limit excedido | Aguarde o tempo indicado em Retry-After |

<Card title="Testar autenticacao" icon="play" href="/api-reference/auth/token">
  Experimente o endpoint de autenticação no playground.
</Card>
